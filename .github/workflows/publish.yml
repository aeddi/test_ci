---
name: Publish
on:
  push:
    branches:
      - master

jobs:
  publish:
    name: Publish Bridge and Core
    runs-on: macos-latest
    timeout-minutes: 30
    steps:
      - name: Checkout changes
        uses: actions/checkout@v2

#       - name: Install Go
#         uses: actions/setup-go@v1
#         with:
#           go-version: 1.14

#       - name: Set GOPATH
#         run: |
#           echo "##[set-env name=GOPATH;]$(go env GOPATH)"
#           echo "##[add-path]$(go env GOPATH)/bin"
#           mkdir -p $(go env GOPATH)/src/github.com/ipfs-shipyard
#           ln -s $PWD $(go env GOPATH)/src/github.com/ipfs-shipyard/gomobile-ipfs
#         shell: bash

#       - name: Restore Go mod cache
#         id: cache
#         uses: actions/cache@v1
#         with:
#           path: ~/go/pkg/mod
#           key: ${{ runner.os }}-go-${{ hashFiles('go/go.sum') }}

#       - name: Install Go mod
#         if: steps.cache.outputs.cache-hit != 'true'
#         working-directory: go
#         run: GO111MODULE=on go mod vendor

#       - name: Install Java
#         uses: actions/setup-java@v1
#         with:
#           java-version: 1.8

#       - name: Set TARGET_SDK
#         run: |
#           pip3 install -r packages/utils/yaml_get/requirements.txt
#           export GET_BIN=packages/utils/yaml_get/yaml_get.py
#           export GET_KEY=global.android.target_sdk_version
#           echo "##[set-env name=TARGET_SDK;]$($GET_BIN $GET_KEY)"

#       - name: Install Android SDK
#         run:
#           SDK_MAN=$HOME/Library/Android/sdk/tools/bin/sdkmanager;
#           BTOOLS=$($SDK_MAN --list | grep "build-tools;$TARGET_SDK");
#           BTOOL=$(echo $BTOOLS | tail -n1 | cut -d'|' -f1 | tr -d ' ');
#           PLATFORMS=$($SDK_MAN --list | grep "platforms;android-$TARGET_SDK");
#           PLATFORM=$(echo $PLATFORMS | tail -n1 | cut -d'|' -f1 | tr -d ' ');

#           $SDK_MAN --install "$BTOOL" platform-tools "$PLATFORM" ndk-bundle
#           > /dev/null

#       - name: Update Cocoapods
#         run: |
#           gem install cocoapods
#           pod setup

#       - name: Publish Android/iOS Bridge and Core
#         working-directory: packages
#         env:
#           BINTRAY_USER: ${{ secrets.BINTRAY_USER }}
#           BINTRAY_KEY: ${{ secrets.BINTRAY_KEY }}
#           BINTRAY_GPG_PASS: ${{ secrets.BINTRAY_GPG_PASS }}
#         run: |
#           make publish_core.android
#           make publish_bridge.android
#           make publish_core.ios
#           make publish_bridge.ios

#   tag_branch:
#     name: Publish version tag
#     runs-on: ubuntu-latest
#     timeout-minutes: 5
#     steps:
#       - name: Checkout changes
#         uses: actions/checkout@v2

#       - name: Set CUR_VERSION
#         run: |
#           sudo apt-get install python3-setuptools
#           pip3 install -r packages/utils/yaml_get/requirements.txt
#           export GET_BIN=packages/utils/yaml_get/yaml_get.py
#           export GET_KEY=global.version
#           echo "##[set-env name=CUR_VERSION;]$($GET_BIN $GET_KEY)"

#       - name: Push version tag
#         uses: anothrNick/github-tag-action@1.17.2
#         env:
#           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#           CUSTOM_TAG: "v${{ env.CUR_VERSION }}"
